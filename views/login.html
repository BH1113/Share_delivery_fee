
{% extends 'layout.html' %}
{% block content %}
<div class="login-form">
  <form action="/auth/login" method="post" id="loginForm">
    <input type="text" name="nick" class="text-field" id="nick" placeholder="아이디">
    <input type="password" name="password" class="text-field" id="pass" placeholder="비밀번호">
    <pre></pre>
    <input type="button" value="로그인" class="login-btn" onclick="formValidator()">
  </form>
  <a href="/join" class="register-btn">회원가입</a>
</div>
{% endblock %}
{% block script %}
<script>
    const $nick = document.getElementById('nick');
    const $pass = document.getElementById('pass');
    let $userCheck = {
      nick: false,
      password: false,
    }

    $nick.addEventListener('blur', function() {
      if (this.value == null){
        $pass.nextSibling.textContent = '아이디 혹은 비밀번호를 입력해주세요.';
      }else $userCheck.nick = true;
    });

    $nick.addEventListener('keyup', function(e) {
      if(e.key !== 'Enter') return;
      if (this.value == null){
        $pass.nextSibling.textContent = '아이디 혹은 비밀번호를 입력해주세요.';
      }else $userCheck.nick = true;
    });

    $pass.addEventListener('blur', function() {
      if (this.value == null){
        $pass.nextSibling.textContent = '아이디 혹은 비밀번호를 입력해주세요.';
      }else $userCheck.password = true;
    });

    $pass.addEventListener('keyup', function(e) {
      if(e.key !== 'Enter') return;
      if (this.value == null){
        $pass.nextSibling.textContent = '아이디 혹은 비밀번호를 입력해주세요.';
      }else $userCheck.password = true;
    });

    let formValidator = function() {
      if (!$userCheck.nick){
        $pass.nextSibling.textContent = '아이디와 비밀번호를 입력해주세요.';
      }else if (!$userCheck.password){
        $pass.nextSibling.textContent = '아이디와 비밀번호를 입력해주세요.';
      }else{
        document.getElementById('loginForm').submit();
      }
    }
    
    window.onload = () => {
        if (new URL(location.href).searchParams.get('error')) {
            alert(new URL(location.href).searchParams.get('error'));
        }
    };
</script>
{% endblock %}